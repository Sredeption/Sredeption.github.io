<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Sredeption</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="system, vision, graphic, network">
<meta property="og:type" content="website">
<meta property="og:title" content="Sredeption">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Sredeption">
<meta property="og:description" content="system, vision, graphic, network">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Sredeption">
<meta name="twitter:description" content="system, vision, graphic, network">
  
    <link rel="alternate" href="/atom.xml" title="Sredeption" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Sredeption</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Rise and rise again until lambs become lions</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-stm-interrupt-driven" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/04/16/stm-interrupt-driven/" class="article-date">
  <time datetime="2016-04-17T02:35:26.000Z" itemprop="datePublished">2016-04-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Embedded-System/">Embedded System</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/04/16/stm-interrupt-driven/">Interrupt Driven STM32</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="PA11-as-a-Interrupt-Source"><a href="#PA11-as-a-Interrupt-Source" class="headerlink" title="PA11 as a Interrupt Source"></a>PA11 as a Interrupt Source</h2><p>Modify the code as following snippet, we will set PA11 as interrupt invoke.<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GPIO_InitStruct.Pin = GPIO_PIN_11;</span><br><span class="line">GPIO_InitStruct.Mode = GPIO_MODE_IT_FALLING;</span><br><span class="line">GPIO_InitStruct.Pull = GPIO_PULLUP;</span><br><span class="line">GPIO_InitStruct.Speed = GPIO_SPEED_LOW;</span><br><span class="line">HAL_GPIO_Init(GPIOA, &amp;GPIO_InitStruct);</span><br></pre></td></tr></table></figure></p>
<h2 id="Handle-the-Interrupt"><a href="#Handle-the-Interrupt" class="headerlink" title="Handle the Interrupt"></a>Handle the Interrupt</h2><p>We must modify the code in interrupt handler.<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">EXTI15_10_IRQHandler</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (HAL_GPIO_ReadPin(GPIOA, GPIO_PIN_11)!=<span class="number">0</span>)&#123;</span><br><span class="line">		HAL_GPIO_EXTI_IRQHandler(GPIO_PIN_11);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (HAL_GPIO_ReadPin(GPIOA, GPIO_PIN_12)!=<span class="number">0</span>)&#123;</span><br><span class="line">		HAL_GPIO_EXTI_IRQHandler(GPIO_PIN_12);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>We need to recognize the interrupt source in the handler.</p>
<h2 id="Callback"><a href="#Callback" class="headerlink" title="Callback"></a>Callback</h2><p>Hence, we could separate the GPIO_Pin in the callback function.<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">HAL_GPIO_EXTI_Callback</span><span class="params">(uint16_t GPIO_Pin)</span></span>&#123;</span><br><span class="line">	<span class="keyword">switch</span> (GPIO_Pin)&#123;</span><br><span class="line">		<span class="keyword">case</span> GPIO_PIN_11:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"Pressed\r\n"</span>);</span><br><span class="line">			mode=!mode;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> GPIO_PIN_12:</span><br><span class="line">			counter++;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="Enter-the-Sleep-Mode"><a href="#Enter-the-Sleep-Mode" class="headerlink" title="Enter the Sleep Mode"></a>Enter the Sleep Mode</h2><p>First, we must diable system tick interrupt. And then, the program must sleep again after the interrupt is handled.<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">HAL_SuspendTick();</span><br><span class="line">HAL_PWR_EnterSLEEPMode(PWR_MAINREGULATOR_ON, PWR_SLEEPENTRY_WFI);</span><br><span class="line">HAL_PWR_EnableSleepOnExit();</span><br><span class="line"><span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"CPU running!\r\n"</span>);</span><br><span class="line">HAL_Delay(<span class="number">100</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="Result"><a href="#Result" class="headerlink" title="Result"></a>Result</h2><p><img src="/images/stm-interrupt-driven/result.png" style="width: 700px;"><br>As you can see, the <strong>CPU running!</strong> in a dead loop only execute once. And other function run well.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/04/16/stm-interrupt-driven/" data-id="cin40478z00094kcjgzysm55p" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/STM32/">STM32</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-init-stm32" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/04/08/init-stm32/" class="article-date">
  <time datetime="2016-04-09T11:46:32.000Z" itemprop="datePublished">2016-04-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Embedded-System/">Embedded System</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/04/08/init-stm32/">Getting Started with STM32 in Windows</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Connect-the-Circuit"><a href="#Connect-the-Circuit" class="headerlink" title="Connect the Circuit"></a>Connect the Circuit</h2><p>In the very first of this experiment, we have to connect the circuit. There is three parts waited to be connect. First, connect the <code>ST-LINK</code>. Second, conect the <code>CP2012</code>. And finally, connect the button to pins on <code>STM32</code>.</p>
<h3 id="Connect-ST-LINK"><a href="#Connect-ST-LINK" class="headerlink" title="Connect ST-LINK"></a>Connect ST-LINK</h3><p>In order to get through the <code>ST-LINK</code>, two steps must be done. The very first step is connect the pins with Dupont Lines. Here is the corresponding pins.</p>
<table>
<thead>
<tr>
<th>ST-LINK</th>
<th style="text-align:right">STM32</th>
</tr>
</thead>
<tbody>
<tr>
<td>SWCLK</td>
<td style="text-align:right">DCLK</td>
</tr>
<tr>
<td>SWDIO</td>
<td style="text-align:right">DIO</td>
</tr>
<tr>
<td>GND</td>
<td style="text-align:right">GND</td>
</tr>
<tr>
<td>3.3V</td>
<td style="text-align:right">3.3V</td>
</tr>
</tbody>
</table>
<p>Next, the driver must be installed.</p>
<h3 id="Connect-CP2012"><a href="#Connect-CP2012" class="headerlink" title="Connect CP2012"></a>Connect CP2012</h3><p>Similarly, I will give the corresponding pins talbe.</p>
<table>
<thead>
<tr>
<th>CP2012</th>
<th style="text-align:right">STM32</th>
</tr>
</thead>
<tbody>
<tr>
<td>3.3v</td>
<td style="text-align:right">3.3v</td>
</tr>
<tr>
<td>GND</td>
<td style="text-align:right">GND</td>
</tr>
<tr>
<td>TXD</td>
<td style="text-align:right">A10</td>
</tr>
<tr>
<td>RXD</td>
<td style="text-align:right">A9</td>
</tr>
</tbody>
</table>
<p>And, of course, make sure driver running correctly.</p>
<h3 id="Connect-Button"><a href="#Connect-Button" class="headerlink" title="Connect Button"></a>Connect Button</h3><p>There are two four ports in one button. In order to input separtely, only two ports could be used. One is connected to ‘GND’ and one is connected to ‘PA11’ or ‘PA12’.<br><img src="/images/init-stm32/connection.png" style="width: 500px;"><br>Here is the circut diagram.</p>
<h2 id="Configuration"><a href="#Configuration" class="headerlink" title="Configuration"></a>Configuration</h2><p>In my opinion, there is some configuration need to be mentioned.</p>
<h3 id="Comment-Removal"><a href="#Comment-Removal" class="headerlink" title="Comment Removal"></a>Comment Removal</h3><p>The some comment mark in <code>stm32f1xx_hal_conf.h</code> must be remove, so that the compiler would link them into executable.<br><img src="/images/init-stm32/comment.png" style="width: 500px;"><br>Especially, following two <code>#define</code> must be released. Because we must use <code>UART</code>, <code>TIM</code> and <code>GPIO</code>.<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> HAL_GPIO_MODULE_ENABLED</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> HAL_TIM_MODULE_ENABLED</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> HAL_UART_MODULE_ENABLED</span></span><br></pre></td></tr></table></figure></p>
<h3 id="Programming-Algorithm"><a href="#Programming-Algorithm" class="headerlink" title="Programming Algorithm"></a>Programming Algorithm</h3><p>The <code>Programming Algorithm</code> must be added, otherwise, we couldn’t program. You could find this dialog in given documentation.<br><img src="/images/init-stm32/program.png" style="width: 500px;"></p>
<h2 id="Initialize-UART"><a href="#Initialize-UART" class="headerlink" title="Initialize UART"></a>Initialize UART</h2><p>One handler must be defined, so that we could initialize with it.<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UART_HandleTypeDef UartHandler;</span><br></pre></td></tr></table></figure></p>
<p>This variable could be global or local. Next, set parameters and initialize.<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">UartHandler.Instance        = USART1;</span><br><span class="line">UartHandler.Init.BaudRate   = <span class="number">9600</span>;</span><br><span class="line">UartHandler.Init.WordLength = UART_WORDLENGTH_8B;</span><br><span class="line">UartHandler.Init.StopBits   = UART_STOPBITS_1;</span><br><span class="line">UartHandler.Init.Parity     = UART_PARITY_NONE;</span><br><span class="line">UartHandler.Init.HwFlowCtl  = UART_HWCONTROL_NONE;</span><br><span class="line">UartHandler.Init.Mode       = UART_MODE_TX_RX;</span><br><span class="line">HAL_UART_Init(&amp;UartHandler);</span><br></pre></td></tr></table></figure></p>
<h2 id="Rewrite-Output"><a href="#Rewrite-Output" class="headerlink" title="Rewrite Output"></a>Rewrite Output</h2><p>Our intent is use <code>printf</code> function write the data to the serial port. So, two function need to be rewritten, which are <code>int __io_putchar(uint8_t ch)</code> and <code>int fputc(int ch, FILE *f)</code> respectively.<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __io_putchar(<span class="keyword">uint8_t</span> ch)&#123;</span><br><span class="line">	HAL_UART_Transmit(&amp;UartHandler, &amp;ch, <span class="number">1</span>, <span class="number">100</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">fputc</span><span class="params">(<span class="keyword">int</span> ch, FILE *f)</span></span>&#123;</span><br><span class="line">	<span class="keyword">uint8_t</span> chr =ch;</span><br><span class="line">	HAL_UART_Transmit(&amp;UartHandler, &amp;chr, <span class="number">1</span>, <span class="number">100</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Now the output would be directed to the serial port.</p>
<h2 id="GPIO-Initilization"><a href="#GPIO-Initilization" class="headerlink" title="GPIO Initilization"></a>GPIO Initilization</h2><p>Two pins must be initilized, <code>PA11</code> and <code>PA12</code>.<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">GPIO_InitTypeDef GPIO_InitStruct;</span><br><span class="line">	</span><br><span class="line">__GPIOA_CLK_ENABLE();</span><br><span class="line"></span><br><span class="line">GPIO_InitStruct.Pin = GPIO_PIN_11;</span><br><span class="line">GPIO_InitStruct.Mode = GPIO_MODE_INPUT;</span><br><span class="line">GPIO_InitStruct.Pull = GPIO_PULLUP;</span><br><span class="line">GPIO_InitStruct.Speed = GPIO_SPEED_LOW;</span><br><span class="line">HAL_GPIO_Init(GPIOA, &amp;GPIO_InitStruct);</span><br><span class="line"></span><br><span class="line">GPIO_InitStruct.Pin = GPIO_PIN_12;</span><br><span class="line">GPIO_InitStruct.Mode = GPIO_MODE_IT_FALLING;</span><br><span class="line">GPIO_InitStruct.Pull = GPIO_PULLUP;</span><br><span class="line">GPIO_InitStruct.Speed = GPIO_SPEED_LOW;</span><br><span class="line">HAL_GPIO_Init(GPIOA, &amp;GPIO_InitStruct);</span><br><span class="line"></span><br><span class="line">HAL_NVIC_SetPriority(EXTI15_10_IRQn,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">HAL_NVIC_EnableIRQ(EXTI15_10_IRQn);</span><br></pre></td></tr></table></figure></p>
<p>The function <code>HAL_GPIO_Init(GPIOA, &amp;GPIO_InitStruct)</code> would call <code>void HAL_UART_MspInit(UART_HandleTypeDef *huart)</code> in <code>stm32f1xx_hal_msp.c</code>. Thus we must fill the code.<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">HAL_UART_MspInit</span><span class="params">(UART_HandleTypeDef *huart)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">	__HAL_RCC_GPIOA_CLK_ENABLE();</span><br><span class="line">	__HAL_RCC_USART1_CLK_ENABLE();</span><br><span class="line">	</span><br><span class="line">	GPIO_InitTypeDef GPIO_InitStruct;</span><br><span class="line">	GPIO_InitStruct.Pin = GPIO_PIN_9;</span><br><span class="line">	GPIO_InitStruct.Mode = GPIO_MODE_AF_PP;</span><br><span class="line">	GPIO_InitStruct.Speed = GPIO_SPEED_HIGH;</span><br><span class="line">	HAL_GPIO_Init(GPIOA, &amp;GPIO_InitStruct);</span><br><span class="line">	GPIO_InitStruct.Pin = GPIO_PIN_10;</span><br><span class="line">	HAL_GPIO_Init(GPIOA, &amp;GPIO_InitStruct);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">HAL_UART_MspDeInit</span><span class="params">(UART_HandleTypeDef *huart)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">	__HAL_RCC_USART1_FORCE_RESET();</span><br><span class="line">	__HAL_RCC_USART1_RELEASE_RESET();</span><br><span class="line">	HAL_GPIO_DeInit(GPIOA, GPIO_PIN_9);</span><br><span class="line">	HAL_GPIO_DeInit(GPIOA, GPIO_PIN_10);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>If <code>__GPIOA_CLK_ENABLE()</code> is not called, the input of <code>PA11</code> would be strange, like a clock. Thus you shouldn’t forget it. And  <code>HAL_NVIC_SetPriority(EXTI15_10_IRQn,0,0)</code> and <code>HAL_NVIC_EnableIRQ(EXTI15_10_IRQn)</code> would set the interrupt for <code>PA12</code>. Now, we need a callback function to handle the push.<br>Add a function in <code>stm32f1xx_it.c</code> to handle the interrupt.<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">EXTI15_10_IRQHandler</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">    HAL_GPIO_EXTI_IRQHandler(GPIO_PIN_12);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>This function would call <code>void HAL_GPIO_EXTI_Callback(uint16_t GPIO_Pin)</code>, so it’s necessary to implement it in <code>main.c</code>.<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">HAL_GPIO_EXTI_Callback</span><span class="params">(uint16_t GPIO_Pin)</span></span>&#123;</span><br><span class="line">	counter++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>According to the requirement, we need to increase <code>counter</code>. So far, we’ve handle the input of <code>PA12</code>. Next, we would handle the <code>PA11</code> in main loop. Add following code snipet in <code>int main(void)</code><br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ((HAL_GPIO_ReadPin(GPIOA, GPIO_PIN_11))==<span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Pressed\r\n"</span>);</span><br><span class="line">    mode=!mode;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Change the mode, of course, and remember that, this condition statement must be enclosed by a loop.</p>
<h2 id="Timer-Initialization"><a href="#Timer-Initialization" class="headerlink" title="Timer Initialization"></a>Timer Initialization</h2><p>Follwing code snippet is to set the serial port parameters. However, I don’t the specific meaning of this statements.<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">TIM_ClockConfigTypeDef sClockSourceConfig;</span><br><span class="line">TIM_MasterConfigTypeDef sMasterConfig;</span><br><span class="line"></span><br><span class="line">TIM_Handler.Instance = TIM3;</span><br><span class="line">TIM_Handler.Init.Prescaler = <span class="number">48000</span>;</span><br><span class="line">TIM_Handler.Init.CounterMode = TIM_COUNTERMODE_UP;</span><br><span class="line">TIM_Handler.Init.Period = <span class="number">199</span>;</span><br><span class="line">TIM_Handler.Init.ClockDivision = TIM_CLOCKDIVISION_DIV1;</span><br><span class="line">HAL_TIM_Base_Init(&amp;TIM_Handler);</span><br><span class="line"></span><br><span class="line">sClockSourceConfig.ClockSource = TIM_CLOCKSOURCE_INTERNAL;</span><br><span class="line">HAL_TIM_ConfigClockSource(&amp;TIM_Handler, &amp;sClockSourceConfig);</span><br><span class="line"></span><br><span class="line">sMasterConfig.MasterOutputTrigger = TIM_TRGO_RESET;</span><br><span class="line">sMasterConfig.MasterSlaveMode = TIM_MASTERSLAVEMODE_DISABLE;</span><br><span class="line">HAL_TIMEx_MasterConfigSynchronization(&amp;TIM_Handler, &amp;sMasterConfig);</span><br></pre></td></tr></table></figure></p>
<p>Then call this function<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HAL_TIM_Base_Start_IT(&amp;TIM_Handler);</span><br></pre></td></tr></table></figure></p>
<p>And this function cooperate with other two function that we must implement in <code>stm32f1xx_hal_msp.c</code>.<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">HAL_TIM_Base_MspInit</span><span class="params">(TIM_HandleTypeDef* htim_base)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(htim_base-&gt;Instance==TIM3)</span><br><span class="line">  &#123;</span><br><span class="line">    __TIM3_CLK_ENABLE();</span><br><span class="line">    HAL_NVIC_SetPriority(TIM3_IRQn, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    HAL_NVIC_EnableIRQ(TIM3_IRQn);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">HAL_TIM_Base_MspDeInit</span><span class="params">(TIM_HandleTypeDef* htim_base)</span></span><br><span class="line"></span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(htim_base-&gt;Instance==TIM3)</span><br><span class="line">  &#123;</span><br><span class="line">    __TIM3_CLK_DISABLE();</span><br><span class="line">    HAL_NVIC_DisableIRQ(TIM3_IRQn);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Similarly, we need to append a handler in <code>stm32f1xx_it.c</code>.<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">TIM3_IRQHandler</span><span class="params">(<span class="keyword">void</span>)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">  HAL_TIM_IRQHandler(&amp;TIM_Handler);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>And the function <code>HAL_TIM_IRQHandler(&amp;TIM_Handler)</code> would call a callback function whose name is <code>void HAL_TIM_PeriodElapsedCallback(TIM_HandleTypeDef *htim)</code>. Just like the condition above, the implementation is necessary.</p>
<pre><code class="C"><span class="function"><span class="keyword">void</span> <span class="title">HAL_TIM_PeriodElapsedCallback</span><span class="params">(TIM_HandleTypeDef *htim)</span></span>{
    <span class="keyword">if</span>(htim-&gt;Instance == TIM3){        
        timer_flag = <span class="number">1</span>;
        timer_counter++;
    }
}
</code></pre>
<h2 id="Result"><a href="#Result" class="headerlink" title="Result"></a>Result</h2><p>Finally, we could check the results.<br><img src="/images/init-stm32/result_1.png" style="width: 500px;"><br>Print <code>Hello</code> as request.<br><img src="/images/init-stm32/result_2.png" style="width: 500px;"><br>Press <code>PA11</code> to change the mode and press <code>PA12</code> to increment distance. The timer counter is always accumalted. For now, I’ve finished the required part.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/04/08/init-stm32/" data-id="cin40478t00054kcj2juivhc5" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/STM32/">STM32</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-arm-inst" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/03/31/arm-inst/" class="article-date">
  <time datetime="2016-04-01T10:28:16.000Z" itemprop="datePublished">2016-03-31</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Embedded-System/">Embedded System</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/31/arm-inst/">Stuff in ARM Instruction</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>This article would study ARM instruction set and how special instruction works and how to implement the function call. </p>
<h2 id="Thumb-VS-ARM"><a href="#Thumb-VS-ARM" class="headerlink" title="Thumb VS ARM"></a>Thumb VS ARM</h2><p>In this section, I will compare ARM instructions and Thumb instructions. First of all, I will present the code analysed.<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>; i &lt; <span class="number">10</span>; i++);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>And I utilized the cross-compile tools in <code>Ubuntu</code> to compile the code.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">arm-linux-gnueabi-gcc test.c -o test.a</span><br><span class="line">arm-linux-gnueabi-gcc test.c -mthumb -o test.t</span><br></pre></td></tr></table></figure></p>
<p>Secondly, use the <code>objdump</code> tool in cross-compile kit to inspect the assemble code.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">arm-linux-gnueabi-objdump -d test.a</span><br><span class="line">arm-linux-gnueabi-objdump -d test.t</span><br></pre></td></tr></table></figure></p>
<h3 id="ARM-code"><a href="#ARM-code" class="headerlink" title="ARM code"></a>ARM code</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">0000840c &lt;main&gt;:</span><br><span class="line">    840c:	e52db004 	push	&#123;fp&#125;		; (str fp, [sp, #-4]!)</span><br><span class="line">    8410:	e28db000 	add	fp, sp, #0</span><br><span class="line">    8414:	e24dd00c 	sub	sp, sp, #12</span><br><span class="line">    8418:	e3a03000 	mov	r3, #0</span><br><span class="line">    841c:	e50b3008 	str	r3, [fp, #-8]</span><br><span class="line">    8420:	ea000002 	b	8430 &lt;main+0x24&gt;</span><br><span class="line">    8424:	e51b3008 	ldr	r3, [fp, #-8]</span><br><span class="line">    8428:	e2833001 	add	r3, r3, #1</span><br><span class="line">    842c:	e50b3008 	str	r3, [fp, #-8]</span><br><span class="line">    8430:	e51b3008 	ldr	r3, [fp, #-8]</span><br><span class="line">    8434:	e3530009 	cmp	r3, #9</span><br><span class="line">    8438:	dafffff9 	ble	8424 &lt;main+0x18&gt;</span><br><span class="line">    843c:	e3a03000 	mov	r3, #0</span><br><span class="line">    8440:	e1a00003 	mov	r0, r3</span><br><span class="line">    8444:	e28bd000 	add	sp, fp, #0</span><br><span class="line">    8448:	e8bd0800 	ldmfd	sp!, &#123;fp&#125;</span><br><span class="line">    844c:	e12fff1e 	bx	lr</span><br></pre></td></tr></table></figure>
<p>As you can see, all instruction compose of 32 bits.</p>
<h3 id="Thumb-code"><a href="#Thumb-code" class="headerlink" title="Thumb code"></a>Thumb code</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">0000840c &lt;main&gt;:</span><br><span class="line">    840c:	b580      	push	&#123;r7, lr&#125;</span><br><span class="line">    840e:	b082      	sub	sp, #8</span><br><span class="line">    8410:	af00      	add	r7, sp, #0</span><br><span class="line">    8412:	2300      	movs	r3, #0</span><br><span class="line">    8414:	607b      	str	r3, [r7, #4]</span><br><span class="line">    8416:	e002      	b.n	841e &lt;main+0x12&gt;</span><br><span class="line">    8418:	687b      	ldr	r3, [r7, #4]</span><br><span class="line">    841a:	3301      	adds	r3, #1</span><br><span class="line">    841c:	607b      	str	r3, [r7, #4]</span><br><span class="line">    841e:	687b      	ldr	r3, [r7, #4]</span><br><span class="line">    8420:	2b09      	cmp	r3, #9</span><br><span class="line">    8422:	ddf9      	ble.n	8418 &lt;main+0xc&gt;</span><br><span class="line">    8424:	2300      	movs	r3, #0</span><br><span class="line">    8426:	1c18      	adds	r0, r3, #0</span><br><span class="line">    8428:	46bd      	mov	sp, r7</span><br><span class="line">    842a:	b002      	add	sp, #8</span><br><span class="line">    842c:	bd80      	pop	&#123;r7, pc&#125;</span><br><span class="line">    842e:	46c0      	nop			; (mov r8, r8)</span><br></pre></td></tr></table></figure>
<p>The instruction consist of 16 bits as our wish. Compare with ARM instructions, this code is only half length. But the number of instructions is similar. That means similar execution time but much shorter program length.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-rwxrwxr-x 1 sea sea 8346 Mar 31 07:08 test.a</span><br><span class="line">-rwxrwxr-x 1 sea sea 8349 Mar 31 07:08 test.t</span><br></pre></td></tr></table></figure></p>
<p>However, the Thumb code executable is bit longer. Of course, the main part of a executable is other code which is prepared for operating system, that is ARM instructions.</p>
<h2 id="Condition-Instruction"><a href="#Condition-Instruction" class="headerlink" title="Condition Instruction"></a>Condition Instruction</h2><p>In this section I will present how to construct the condition execution instructions. Because the compiler would generate normal instruction as a default approach, the optimization option must be galvanized. Of course, the target code must be demonstrated at first.<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a, b;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;a, &amp;b);</span><br><span class="line">    <span class="keyword">if</span> (a&gt;b)</span><br><span class="line">        a++;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        b++;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d %d"</span>, a, b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>And the compile script.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arm-linux-gnueabi-gcc test.c -o test.a -O</span><br></pre></td></tr></table></figure></p>
<p>Now we could see the condition instructions.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">0000849c &lt;main&gt;:</span><br><span class="line">    849c:	e52de004 	push	&#123;lr&#125;		; (str lr, [sp, #-4]!)</span><br><span class="line">    84a0:	e24dd00c 	sub	sp, sp, #12</span><br><span class="line">    84a4:	e59f0040 	ldr	r0, [pc, #64]	; 84ec &lt;main+0x50&gt;</span><br><span class="line">    84a8:	e1a0100d 	mov	r1, sp</span><br><span class="line">    84ac:	e28d2004 	add	r2, sp, #4</span><br><span class="line">    84b0:	ebffffa6 	bl	8350 &lt;_init+0x44&gt;</span><br><span class="line">    84b4:	e59d2000 	ldr	r2, [sp]</span><br><span class="line">    84b8:	e59d3004 	ldr	r3, [sp, #4]</span><br><span class="line">    84bc:	e1520003 	cmp	r2, r3</span><br><span class="line">    84c0:	c2822001 	addgt	r2, r2, #1</span><br><span class="line">    84c4:	c58d2000 	strgt	r2, [sp]</span><br><span class="line">    84c8:	d2833001 	addle	r3, r3, #1</span><br><span class="line">    84cc:	d58d3004 	strle	r3, [sp, #4]</span><br><span class="line">    84d0:	e3a00001 	mov	r0, #1</span><br><span class="line">    84d4:	e59f1010 	ldr	r1, [pc, #16]	; 84ec &lt;main+0x50&gt;</span><br><span class="line">    84d8:	e59d2000 	ldr	r2, [sp]</span><br><span class="line">    84dc:	e59d3004 	ldr	r3, [sp, #4]</span><br><span class="line">    84e0:	ebffff97 	bl	8344 &lt;_init+0x38&gt;</span><br><span class="line">    84e4:	e28dd00c 	add	sp, sp, #12</span><br><span class="line">    84e8:	e8bd8000 	ldmfd	sp!, &#123;pc&#125;</span><br><span class="line">    84ec:	00008564 	.word	0x00008564</span><br></pre></td></tr></table></figure></p>
<h2 id="Register-Shift"><a href="#Register-Shift" class="headerlink" title="Register Shift"></a>Register Shift</h2><p>Let’s construct scenario that would generate register shift instruction. Target code is here.<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a, b;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;a, &amp;b);</span><br><span class="line">    a = a + b &lt;&lt; <span class="number">4</span>;</span><br><span class="line">    a = a + b &lt;&lt; <span class="number">4</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d %d"</span>, a, b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Of course, in order to avoid the compiler generate normal instruction we must use the optimization option. However, the optimization would eliminate every code because of the unuse of variable. Thus, input and output is introduced.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arm-linux-gnueabi-gcc test.c -o test.a -O</span><br></pre></td></tr></table></figure></p>
<p>Dump it, check the machine code.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">0000849c &lt;main&gt;:</span><br><span class="line">    849c:	e92d4010 	push	&#123;r4, lr&#125;</span><br><span class="line">    84a0:	e24dd008 	sub	sp, sp, #8</span><br><span class="line">    84a4:	e59f4038 	ldr	r4, [pc, #56]	; 84e4 &lt;main+0x48&gt;</span><br><span class="line">    84a8:	e1a00004 	mov	r0, r4</span><br><span class="line">    84ac:	e1a0100d 	mov	r1, sp</span><br><span class="line">    84b0:	e28d2004 	add	r2, sp, #4</span><br><span class="line">    84b4:	ebffffa5 	bl	8350 &lt;_init+0x44&gt;</span><br><span class="line">    84b8:	e59d3004 	ldr	r3, [sp, #4]</span><br><span class="line">    84bc:	e59d2000 	ldr	r2, [sp]</span><br><span class="line">    84c0:	e0832002 	add	r2, r3, r2</span><br><span class="line">    84c4:	e0832202 	add	r2, r3, r2, lsl #4</span><br><span class="line">    84c8:	e1a02202 	lsl	r2, r2, #4</span><br><span class="line">    84cc:	e58d2000 	str	r2, [sp]</span><br><span class="line">    84d0:	e3a00001 	mov	r0, #1</span><br><span class="line">    84d4:	e1a01004 	mov	r1, r4</span><br><span class="line">    84d8:	ebffff99 	bl	8344 &lt;_init+0x38&gt;</span><br><span class="line">    84dc:	e28dd008 	add	sp, sp, #8</span><br><span class="line">    84e0:	e8bd8010 	pop	&#123;r4, pc&#125;</span><br><span class="line">    84e4:	0000855c 	.word	0x0000855c</span><br></pre></td></tr></table></figure></p>
<h2 id="Load-a-32-bits-number"><a href="#Load-a-32-bits-number" class="headerlink" title="Load a 32-bits number"></a>Load a 32-bits number</h2><p>Now, I will show how the assigment is implemented.<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a, b;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;a, &amp;b);</span><br><span class="line">    a=<span class="number">0x12312312</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d %d"</span>, a, b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Variable <code>int a</code> would be assigned by a 32-bits number. Compile it, and check the assemble language.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">00008494 &lt;main&gt;:</span><br><span class="line">    8494:	e92d4800 	push	&#123;fp, lr&#125;</span><br><span class="line">    8498:	e28db004 	add	fp, sp, #4</span><br><span class="line">    849c:	e24dd008 	sub	sp, sp, #8</span><br><span class="line">    84a0:	e24b200c 	sub	r2, fp, #12</span><br><span class="line">    84a4:	e24b3008 	sub	r3, fp, #8</span><br><span class="line">    84a8:	e59f0034 	ldr	r0, [pc, #52]	; 84e4 &lt;main+0x50&gt;</span><br><span class="line">    84ac:	e1a01002 	mov	r1, r2</span><br><span class="line">    84b0:	e1a02003 	mov	r2, r3</span><br><span class="line">    84b4:	ebffffa3 	bl	8348 &lt;_init+0x44&gt;</span><br><span class="line">    84b8:	e59f3028 	ldr	r3, [pc, #40]	; 84e8 &lt;main+0x54&gt;</span><br><span class="line">    84bc:	e50b300c 	str	r3, [fp, #-12]</span><br><span class="line">    84c0:	e51b200c 	ldr	r2, [fp, #-12]</span><br><span class="line">    84c4:	e51b3008 	ldr	r3, [fp, #-8]</span><br><span class="line">    84c8:	e59f0014 	ldr	r0, [pc, #20]	; 84e4 &lt;main+0x50&gt;</span><br><span class="line">    84cc:	e1a01002 	mov	r1, r2</span><br><span class="line">    84d0:	e1a02003 	mov	r2, r3</span><br><span class="line">    84d4:	ebffff92 	bl	8324 &lt;_init+0x20&gt;</span><br><span class="line">    84d8:	e1a00003 	mov	r0, r3</span><br><span class="line">    84dc:	e24bd004 	sub	sp, fp, #4</span><br><span class="line">    84e0:	e8bd8800 	pop	&#123;fp, pc&#125;</span><br><span class="line">    84e4:	00008560 	.word	0x00008560</span><br><span class="line">    84e8:	12312312 	.word	0x12312312</span><br></pre></td></tr></table></figure></p>
<p>As you can see, the constant is stored in bottom of code. And the content in the memory would be load into register directly by using instruction <code>ldr</code>.</p>
<h2 id="Function-Call"><a href="#Function-Call" class="headerlink" title="Function Call"></a>Function Call</h2><p>Function call is a important part in every program. So that, I will study the function call mechanism in this section.<br>Let’s present the target code as ususal.<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">x</span><span class="params">(<span class="keyword">int</span> a)</span></span>&#123;</span><br><span class="line">    a=<span class="number">0x440</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d"</span>, a);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">g</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span>&#123;</span><br><span class="line">    b=<span class="number">0x220</span>;</span><br><span class="line">    b = b+<span class="number">1</span>;</span><br><span class="line">    x(b);</span><br><span class="line">    b = b+<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">f</span><span class="params">(<span class="keyword">int</span> a)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> b=<span class="number">0x130</span>;</span><br><span class="line">    b = b+<span class="number">1</span>;</span><br><span class="line">    g(b, a);</span><br><span class="line">    b = b+<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a, b;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d %d"</span>, &amp;a, &amp;b);</span><br><span class="line">    a=<span class="number">0x12312312</span>;</span><br><span class="line">    f(a);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d %d"</span>, a, b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Then, compile it and inspect the machine code.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">00008510 &lt;f&gt;:</span><br><span class="line">    8510:	e92d4800 	push	&#123;fp, lr&#125;</span><br><span class="line">    8514:	e28db004 	add	fp, sp, #4</span><br><span class="line">    8518:	e24dd010 	sub	sp, sp, #16</span><br><span class="line">    851c:	e50b0010 	str	r0, [fp, #-16]</span><br><span class="line">    8520:	e3a03e13 	mov	r3, #304	; 0x130</span><br><span class="line">    8524:	e50b3008 	str	r3, [fp, #-8]</span><br><span class="line">    8528:	e51b3008 	ldr	r3, [fp, #-8]</span><br><span class="line">    852c:	e2833001 	add	r3, r3, #1</span><br><span class="line">    8530:	e50b3008 	str	r3, [fp, #-8]</span><br><span class="line">    8534:	e51b0008 	ldr	r0, [fp, #-8]</span><br><span class="line">    8538:	e51b1010 	ldr	r1, [fp, #-16]</span><br><span class="line">    853c:	ebffffe1 	bl	84c8 &lt;g&gt;</span><br><span class="line">    8540:	e51b3008 	ldr	r3, [fp, #-8]</span><br><span class="line">    8544:	e2833001 	add	r3, r3, #1</span><br><span class="line">    8548:	e50b3008 	str	r3, [fp, #-8]</span><br><span class="line">    854c:	e1a00003 	mov	r0, r3</span><br><span class="line">    8550:	e24bd004 	sub	sp, fp, #4</span><br><span class="line">    8554:	e8bd8800 	pop	&#123;fp, pc&#125;</span><br><span class="line">    </span><br><span class="line">00008558 &lt;main&gt;:</span><br><span class="line">    8558:	e92d4800 	push	&#123;fp, lr&#125;</span><br><span class="line">    855c:	e28db004 	add	fp, sp, #4</span><br><span class="line">    8560:	e24dd008 	sub	sp, sp, #8</span><br><span class="line">    8564:	e24b200c 	sub	r2, fp, #12</span><br><span class="line">    8568:	e24b3008 	sub	r3, fp, #8</span><br><span class="line">    856c:	e59f0040 	ldr	r0, [pc, #64]	; 85b4 &lt;main+0x5c&gt;</span><br><span class="line">    8570:	e1a01002 	mov	r1, r2</span><br><span class="line">    8574:	e1a02003 	mov	r2, r3</span><br><span class="line">    8578:	ebffff72 	bl	8348 &lt;_init+0x44&gt;</span><br><span class="line">    857c:	e59f3034 	ldr	r3, [pc, #52]	; 85b8 &lt;main+0x60&gt;</span><br><span class="line">    8580:	e50b300c 	str	r3, [fp, #-12]</span><br><span class="line">    8584:	e51b300c 	ldr	r3, [fp, #-12]</span><br><span class="line">    8588:	e1a00003 	mov	r0, r3</span><br><span class="line">    858c:	ebffffdf 	bl	8510 &lt;f&gt;</span><br><span class="line">    8590:	e51b200c 	ldr	r2, [fp, #-12]</span><br><span class="line">    8594:	e51b3008 	ldr	r3, [fp, #-8]</span><br><span class="line">    8598:	e59f0014 	ldr	r0, [pc, #20]	; 85b4 &lt;main+0x5c&gt;</span><br><span class="line">    859c:	e1a01002 	mov	r1, r2</span><br><span class="line">    85a0:	e1a02003 	mov	r2, r3</span><br><span class="line">    85a4:	ebffff5e 	bl	8324 &lt;_init+0x20&gt;</span><br><span class="line">    85a8:	e1a00003 	mov	r0, r3</span><br><span class="line">    85ac:	e24bd004 	sub	sp, fp, #4</span><br><span class="line">    85b0:	e8bd8800 	pop	&#123;fp, pc&#125;</span><br><span class="line">    85b4:	00008634 	.word	0x00008634</span><br><span class="line">    85b8:	12312312 	.word	0x12312312</span><br><span class="line"></span><br><span class="line">00008494 &lt;x&gt;:</span><br><span class="line">    8494:	e92d4800 	push	&#123;fp, lr&#125;</span><br><span class="line">    8498:	e28db004 	add	fp, sp, #4</span><br><span class="line">    849c:	e24dd010 	sub	sp, sp, #16</span><br><span class="line">    84a0:	e50b0010 	str	r0, [fp, #-16]</span><br><span class="line">    84a4:	e3a03d11 	mov	r3, #1088	; 0x440</span><br><span class="line">    84a8:	e50b3008 	str	r3, [fp, #-8]</span><br><span class="line">    84ac:	e59f0010 	ldr	r0, [pc, #16]	; 84c4 &lt;x+0x30&gt;</span><br><span class="line">    84b0:	e51b1008 	ldr	r1, [fp, #-8]</span><br><span class="line">    84b4:	ebffff9a 	bl	8324 &lt;_init+0x20&gt;</span><br><span class="line">    84b8:	e1a00003 	mov	r0, r3</span><br><span class="line">    84bc:	e24bd004 	sub	sp, fp, #4</span><br><span class="line">    84c0:	e8bd8800 	pop	&#123;fp, pc&#125;</span><br><span class="line">    84c4:	00008630 	.word	0x00008630</span><br><span class="line"></span><br><span class="line">000084c8 &lt;g&gt;:</span><br><span class="line">    84c8:	e92d4800 	push	&#123;fp, lr&#125;</span><br><span class="line">    84cc:	e28db004 	add	fp, sp, #4</span><br><span class="line">    84d0:	e24dd010 	sub	sp, sp, #16</span><br><span class="line">    84d4:	e50b0010 	str	r0, [fp, #-16]</span><br><span class="line">    84d8:	e50b1014 	str	r1, [fp, #-20]</span><br><span class="line">    84dc:	e3a03e22 	mov	r3, #544	; 0x220</span><br><span class="line">    84e0:	e50b3008 	str	r3, [fp, #-8]</span><br><span class="line">    84e4:	e51b3008 	ldr	r3, [fp, #-8]</span><br><span class="line">    84e8:	e2833001 	add	r3, r3, #1</span><br><span class="line">    84ec:	e50b3008 	str	r3, [fp, #-8]</span><br><span class="line">    84f0:	e51b0008 	ldr	r0, [fp, #-8]</span><br><span class="line">    84f4:	ebffffe6 	bl	8494 &lt;x&gt;</span><br><span class="line">    84f8:	e51b3008 	ldr	r3, [fp, #-8]</span><br><span class="line">    84fc:	e2833001 	add	r3, r3, #1</span><br><span class="line">    8500:	e50b3008 	str	r3, [fp, #-8]</span><br><span class="line">    8504:	e1a00003 	mov	r0, r3</span><br><span class="line">    8508:	e24bd004 	sub	sp, fp, #4</span><br><span class="line">    850c:	e8bd8800 	pop	&#123;fp, pc&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="Return-Address"><a href="#Return-Address" class="headerlink" title="Return Address"></a>Return Address</h3><p>The return address would be stored in register <code>lr</code> when the instruction <code>bl</code> is executed. And whenever the call is invoked, the return address would be pushed into stack.</p>
<h3 id="Parameter-Passing"><a href="#Parameter-Passing" class="headerlink" title="Parameter Passing"></a>Parameter Passing</h3><p>The parameter is passed through register <code>R0</code> and <code>R1</code>.</p>
<h3 id="Local-Variable"><a href="#Local-Variable" class="headerlink" title="Local Variable"></a>Local Variable</h3><p>The variable would be allocated when the function call is made. First of all, the local stack space woudl be allocated by frame pointer. After the return address is pushed to the stack, the local variable would stored sequentially.</p>
<h3 id="Reigster-Save"><a href="#Reigster-Save" class="headerlink" title="Reigster Save"></a>Reigster Save</h3><p>R0-R3 is saved by caller but the register above R4 is saved by callee.</p>
<h2 id="BIC"><a href="#BIC" class="headerlink" title="BIC"></a>BIC</h2><p>In order to obtin the BIC instruction, we must do some operation that is similiar to the logic of this instruction.<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a, b, c, d;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d %d %d %d"</span>, &amp;a, &amp;b, &amp;c, &amp;d);</span><br><span class="line">    a = b &amp; (~c);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d %d %d %d"</span>, a, b, c, d);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>And, the optimazation option is necessary.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arm-linux-gnueabi-gcc test.c -o test.a -O</span><br></pre></td></tr></table></figure></p>
<p>Then, we could find out the BIC instruction.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">0000849c &lt;main&gt;:</span><br><span class="line">    849c:	e92d4010 	push	&#123;r4, lr&#125;</span><br><span class="line">    84a0:	e24dd018 	sub	sp, sp, #24</span><br><span class="line">    84a4:	e59f4048 	ldr	r4, [pc, #72]	; 84f4 &lt;main+0x58&gt;</span><br><span class="line">    84a8:	e28d3014 	add	r3, sp, #20</span><br><span class="line">    84ac:	e58d3000 	str	r3, [sp]</span><br><span class="line">    84b0:	e1a00004 	mov	r0, r4</span><br><span class="line">    84b4:	e28d1008 	add	r1, sp, #8</span><br><span class="line">    84b8:	e28d200c 	add	r2, sp, #12</span><br><span class="line">    84bc:	e28d3010 	add	r3, sp, #16</span><br><span class="line">    84c0:	ebffffa2 	bl	8350 &lt;_init+0x44&gt;</span><br><span class="line">    84c4:	e59d1010 	ldr	r1, [sp, #16]</span><br><span class="line">    84c8:	e59d300c 	ldr	r3, [sp, #12]</span><br><span class="line">    84cc:	e1c32001 	bic	r2, r3, r1</span><br><span class="line">    84d0:	e58d2008 	str	r2, [sp, #8]</span><br><span class="line">    84d4:	e58d1000 	str	r1, [sp]</span><br><span class="line">    84d8:	e59d1014 	ldr	r1, [sp, #20]</span><br><span class="line">    84dc:	e58d1004 	str	r1, [sp, #4]</span><br><span class="line">    84e0:	e3a00001 	mov	r0, #1</span><br><span class="line">    84e4:	e1a01004 	mov	r1, r4</span><br><span class="line">    84e8:	ebffff95 	bl	8344 &lt;_init+0x38&gt;</span><br><span class="line">    84ec:	e28dd018 	add	sp, sp, #24</span><br><span class="line">    84f0:	e8bd8010 	pop	&#123;r4, pc&#125;</span><br><span class="line">    84f4:	0000856c 	.word	0x0000856c</span><br></pre></td></tr></table></figure></p>
<h2 id="Inline-Assembly"><a href="#Inline-Assembly" class="headerlink" title="Inline Assembly"></a>Inline Assembly</h2><p>In this section, I write a pure ARM assembly function. There is one thing deserved to be mentioned, which is we must store and load the return address, so that the function would be executed properly.<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">asm</span>(</span><br><span class="line">    <span class="string">"test:"</span></span><br><span class="line">    <span class="string">"push   &#123;r3, r4, fp, lr&#125;\n"</span></span><br><span class="line">    <span class="string">"add    r3, r0, r1\n"</span></span><br><span class="line">    <span class="string">"mov    r4, #0\n"</span></span><br><span class="line">    <span class="string">"strb   r4, [r3]\n"</span></span><br><span class="line">    <span class="string">"bl     puts\n"</span></span><br><span class="line">    <span class="string">"pop    &#123;r3, r4, fp, pc&#125;\n"</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> s[<span class="number">10</span>]=<span class="string">"abcdefghij"</span>;</span><br><span class="line">    test(s, <span class="number">3</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>And I invoke the function <code>puts</code> to print the string.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/03/31/arm-inst/" data-id="cin40478h00014kcjew02033f" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ARM/">ARM</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-init-raspberry" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/03/09/init-raspberry/" class="article-date">
  <time datetime="2016-03-10T04:48:08.000Z" itemprop="datePublished">2016-03-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Embedded-System/">Embedded System</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/09/init-raspberry/">Getting started with RaspberryPi</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>I have gotten through the serial port connection of <code>RaspberryPi</code>. Besides, our development board is not<br>brand new, so the refurbishment is necessary.</p>
<h2 id="Refurbishment-of-Raspbian"><a href="#Refurbishment-of-Raspbian" class="headerlink" title="Refurbishment of Raspbian"></a>Refurbishment of Raspbian</h2><p>In this section, I will introduce how download operating system image to this board. At the very first, you must prepare <code>Win32DiskImager</code> and a OS image like <code>2016-02-26-raspbian-jessie-lite.img</code> as I used. Now, insert your SD card to the computer and make sure the <code>lock</code> on SD card is <code>opened</code>.<br><img src="/images/init-raspberry/sd-lock.png" style="width: 500px;"><br>Open <code>Disk Imager</code> and write image to the board.<br><img src="/images/init-raspberry/down.png" style="width: 500px;"></p>
<h2 id="Get-through-the-Serial-Port"><a href="#Get-through-the-Serial-Port" class="headerlink" title="Get through the Serial Port"></a>Get through the Serial Port</h2><p>In order to avoid your confusion, the I prefer presenting the connection picture instead of circuit. Of course, you must ensure that your serial port driver work out. You could consult <a href="">Getting Started with WRTNode on Windows 8.1</a> for detail.<br><img src="/images/init-raspberry/connection.png" style="width: 700px;"><br>Open <code>putty</code> and input <code>Serial line</code> and <code>Speed</code> like below image, them click <code>Open</code>.<br><img src="/images/init-raspberry/pt.png" style="width: 500px;"><br>As you can, we connect succecfully. Besides, your default login name is <code>pi</code> and password is <code>raspberry</code>.<br>By connection using serial port, you could read the <code>Starting Content</code>. Unfortunately, in my <code>windows 8.1</code> platform, the bug of serial port driver would lead a <strong>crash</strong> of system. Thus, I prefer another way to connect <code>Raspberry</code>.</p>
<h2 id="Connection-by-LAN"><a href="#Connection-by-LAN" class="headerlink" title="Connection by LAN"></a>Connection by LAN</h2><p>By using a cable connecting <code>Raspberry Pi</code> with <code>Router</code>, <code>Raspberry Pi</code> could be visted like a client.<br><img src="/images/init-raspberry/net.png" style="width: 500px;"><br>Also, the router device manager would show your IP of <code>Raspberry Pi</code>.<br><img src="/images/init-raspberry/router.png" style="width: 500px;"><br>It’s time to login with <code>Putty</code>.<br><img src="/images/init-raspberry/net-pt.png" style="width: 500px;"><br><img src="/images/init-raspberry/login.png" style="width: 500px;"></p>
<h2 id="Cross-Compiling"><a href="#Cross-Compiling" class="headerlink" title="Cross Compiling"></a>Cross Compiling</h2><p>PC is better place to develop software, which is the motivation of Cross Compiling. However, windows is not a good place for raspberry development. I couldn’t find cros compiling tools for windows, but for linux.<br>In Ubuntu 14.04, <code>apt-get</code> is utilized to gain the tools.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">apt-get install gcc-arm-linux-gnueabi make ncurses-dev</span><br><span class="line">arm-linux-gnueabi-gcc hello.c</span><br><span class="line">scp a.out pi@192.168.1.101:~/hello.out</span><br></pre></td></tr></table></figure></p>
<p>When you compile the file successfully, you could <code>scp</code> the executable to the <code>raspberrypi</code>. And, execute! Then you could see that.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello World!</span><br></pre></td></tr></table></figure></p>
<h2 id="Starting-Content"><a href="#Starting-Content" class="headerlink" title="Starting Content"></a>Starting Content</h2><p>Uncompressing Linux… done, booting the kernel.<br>[    0.000000] Booting Linux on physical CPU 0x0 //Linux would execute from address 0x0<br>[    0.000000] Initializing cgroup subsys cpuset //initialize subsystem cpuset<br>[    0.000000] Initializing cgroup subsys cpu<br>[    0.000000] Initializing cgroup subsys cpuacct<br>[    0.000000] Linux version 4.1.18+ (dc4@dc4-XPS13-9333) (gcc version 4.9.3 (crosstool-NG crosstool-ng-1.22.0-88-g8460611) ) #846 Thu Feb 25 14:11:56 GMT 2016 //Linux Version<br>[    0.000000] CPU: ARMv6-compatible processor [410fb767] revision 7 (ARMv7), cr=00c5387d // CPU information<br>[    0.000000] CPU: PIPT / VIPT nonaliasing data cache, VIPT nonaliasing instruction cache<br>[    0.000000] Machine model: Raspberry Pi Model B Rev 2 // Booting model of raspberry<br>[    0.000000] cma: Reserved 8 MiB at 0x1b400000<br>[    0.000000] Memory policy: Data cache writeback // cache strategy<br>[    0.000000] Built 1 zonelists in Zone order, mobility grouping on.  Total pages: 113680<br>[    0.000000] Kernel command line: dma.dmachans=0x7f35 bcm2708_fb.fbwidth=656 bcm2708_fb.fbheight=416 bcm2708.boardrev=0xf bcm2708.serial=0xb633a796 smsc95xx.macaddr=B8:27:EB:33:A7:96 bcm2708_fb.fbswap=1 bcm2708.uart_clock=3000000 vc_mem.mem_base=0x1ec00000 vc_mem.mem_size=0x20000000  dwc_otg.lpm_enable=0 console=ttyAMA0,115200 console=tty1 root=/dev/mmcblk0p2 rootfstype=ext4 elevator=deadline fsck.repair=yes rootwait<br>[    0.000000] PID hash table entries: 2048 (order: 1, 8192 bytes)<br>[    0.000000] Dentry cache hash table entries: 65536 (order: 6, 262144 bytes)<br>[    0.000000] Inode-cache hash table entries: 32768 (order: 5, 131072 bytes)<br>[    0.000000] Memory: 436836K/458752K available (5792K kernel code, 488K rwdata, 1788K rodata, 352K init, 720K bss, 13724K reserved, 8192K cma-reserved)<br>[    0.000000] Virtual kernel memory layout: // memory layout<br>[    0.000000]     vector  : 0xffff0000 - 0xffff1000   (   4 kB)<br>[    0.000000]     fixmap  : 0xffc00000 - 0xfff00000   (3072 kB)<br>[    0.000000]     vmalloc : 0xdc800000 - 0xff000000   ( 552 MB)<br>[    0.000000]     lowmem  : 0xc0000000 - 0xdc000000   ( 448 MB)<br>[    0.000000]     modules : 0xbf000000 - 0xc0000000   (  16 MB)<br>[    0.000000]       .text : 0xc0008000 - 0xc076f1f0   (7581 kB)<br>[    0.000000]       .init : 0xc0770000 - 0xc07c8000   ( 352 kB)<br>[    0.000000]       .data : 0xc07c8000 - 0xc0842260   ( 489 kB)<br>[    0.000000]        .bss : 0xc0842260 - 0xc08f63e0   ( 721 kB)<br>[    0.000000] SLUB: HWalign=32, Order=0-3, MinObjects=0, CPUs=1, Nodes=1<br>[    0.000000] NR_IRQS:522<br>[    0.000000] clocksource stc: mask: 0xffffffff max_cycles: 0xffffffff, max_idle_ns: 1911260446275 ns<br>[    0.000014] sched_clock: 32 bits at 1000kHz, resolution 1000ns, wraps every 2147483647500ns<br>[    0.000055] Switching to timer-based delay loop, resolution 1000ns<br>[    0.000339] Console: colour dummy device 80x30<br>[    0.001263] console [tty1] enabled<br>[    0.001322] Calibrating delay loop (skipped), value calculated using timer frequency.. 2.00 BogoMIPS (lpj=10000)<br>[    0.001407] pid_max: default: 32768 minimum: 301<br>[    0.001784] Mount-cache hash table entries: 1024 (order: 0, 4096 bytes)<br>[    0.001854] Mountpoint-cache hash table entries: 1024 (order: 0, 4096 bytes)<br>[    0.002904] Initializing cgroup subsys blkio // initialize other sub systems<br>[    0.002997] Initializing cgroup subsys memory<br>[    0.003068] Initializing cgroup subsys devices<br>[    0.003131] Initializing cgroup subsys freezer<br>[    0.003191] Initializing cgroup subsys net_cls<br>[    0.003309] CPU: Testing write buffer coherency: ok<br>[    0.003428] ftrace: allocating 19747 entries in 58 pages<br>[    0.107997] Setting up static identity map for 0x81c0 - 0x81f8<br>[    0.110174] devtmpfs: initialized<br>[    0.120996] VFP support v0.3: implementor 41 architecture 1 part 20 variant b rev 5<br>[    0.121448] clocksource jiffies: mask: 0xffffffff max_cycles: 0xffffffff, max_idle_ns: 19112604462750000 ns<br>[    0.123452] pinctrl core: initialized pinctrl subsystem<br>[    0.124353] NET: Registered protocol family 16<br>[    0.129822] DMA: preallocated 4096 KiB pool for atomic coherent allocations //DMA information<br>[    0.131309] bcm2708.uart_clock = 3000000<br>[    0.136188] hw-breakpoint: found 6 breakpoint and 1 watchpoint registers.<br>[    0.136264] hw-breakpoint: maximum watchpoint size is 4 bytes.<br>[    0.136469] Serial: AMBA PL011 UART driver<br>[    0.136768] 20201000.uart: ttyAMA0 at MMIO 0x20201000 (irq = 83, base_baud = 0) is a PL011 rev2<br>[    0.504783] console [ttyAMA0] enabled<br>[    0.509180] bcm2835-mbox 2000b880.mailbox: mailbox enabled<br>[    0.555152] bcm2708-dmaengine 20007000.dma: DMA legacy API manager at f2007000, dmachans=0xf35<br>[    0.563881] bcm2708-dmaengine 20007000.dma: Initialized 7 DMA channels (+ 1 legacy)<br>[    0.572447] bcm2708-dmaengine 20007000.dma: Load BCM2835 DMA engine driver<br>[    0.579375] bcm2708-dmaengine 20007000.dma: dma_debug:0<br>[    0.585524] SCSI subsystem initialized<br>[    0.589687] usbcore: registered new interface driver usbfs<br>[    0.595405] usbcore: registered new interface driver hub<br>[    0.600937] usbcore: registered new device driver usb<br>[    0.606962] raspberrypi-firmware soc:firmware: Attached to firmware from 2016-02-25 14:25<br>[    0.642645] Switched to clocksource stc<br>[    0.695761] FS-Cache: Loaded<br>[    0.699061] CacheFiles: Loaded<br>[    0.717829] NET: Registered protocol family 2<br>[    0.723757] TCP established hash table entries: 4096 (order: 2, 16384 bytes)//initialize TCP<br>[    0.730947] TCP bind hash table entries: 4096 (order: 2, 16384 bytes)<br>[    0.737578] TCP: Hash tables configured (established 4096 bind 4096)<br>[    0.744216] UDP hash table entries: 256 (order: 0, 4096 bytes)<br>[    0.750112] UDP-Lite hash table entries: 256 (order: 0, 4096 bytes)<br>[    0.756799] NET: Registered protocol family 1<br>[    0.761767] RPC: Registered named UNIX socket transport module.<br>[    0.767822] RPC: Registered udp transport module.<br>[    0.772557] RPC: Registered tcp transport module.<br>[    0.777323] RPC: Registered tcp NFSv4.1 backchannel transport module.<br>[    0.785046] hw perfevents: enabled with armv6_1176 PMU driver, 3 counters available<br>[    0.794182] futex hash table entries: 256 (order: -1, 3072 bytes)<br>[    0.816618] VFS: Disk quotas dquot_6.6.0// VFS information<br>[    0.820999] VFS: Dquot-cache hash table entries: 1024 (order 0, 4096 bytes)<br>[    0.830680] FS-Cache: Netfs ‘nfs’ registered for caching<br>[    0.837438] NFS: Registering the id_resolver key type<br>[    0.842616] Key type id_resolver registered<br>[    0.846953] Key type id_legacy registered<br>[    0.854796] Block layer SCSI generic (bsg) driver version 0.4 loaded (major 252)<br>[    0.862778] io scheduler noop registered<br>[    0.866779] io scheduler deadline registered (default)<br>[    0.872354] io scheduler cfq registered<br>[    0.878777] BCM2708FB: allocated DMA memory 5b800000<br>[    0.883951] BCM2708FB: allocated DMA channel 0 @ f2007000<br>[    0.894517] Console: switching to colour frame buffer device 82x26<br>[    0.905754] Serial: 8250/16550 driver, 0 ports, IRQ sharing disabled<br>[    0.915513] vc-cma: Videocore CMA driver<br>[    0.921209] vc-cma: vc_cma_base      = 0x00000000<br>[    0.927667] vc-cma: vc_cma_size      = 0x00000000 (0 MiB)<br>[    0.934745] vc-cma: vc_cma_initial   = 0x00000000 (0 MiB)<br>[    0.942041] vc-mem: phys_addr:0x00000000 mem_base=0x1ec00000 mem_size:0x20000000(512 MiB)<br>[    0.972531] brd: module loaded<br>[    0.986428] loop: module loaded<br>[    0.992227] vchiq: vchiq_init_state: slot_zero = 0xdb880000, is_master = 0<br>[    1.002848] Loading iSCSI transport class v2.0-870.<br>[    1.010911] usbcore: registered new interface driver smsc95xx<br>[    1.018561] dwc_otg: version 3.00a 10-AUG-2012 (platform bus)<br>[    1.226240] Core Release: 2.80a<br>[    1.230928] Setting default values for core params<br>[    1.237309] Finished setting default values for core params<br>[    1.444723] Using Buffer DMA mode<br>[    1.449623] Periodic Transfer Interrupt Enhancement - disabled<br>[    1.457074] Multiprocessor Interrupt Enhancement - disabled<br>[    1.464295] OTG VER PARAM: 0, OTG VER FLAG: 0<br>[    1.470287] Dedicated Tx FIFOs mode<br>[    1.475872] WARN::dwc_otg_hcd_init:1047: FIQ DMA bounce buffers: virt = 0xdb814000 dma = 0x5b814000 len=9024<br>[    1.489017] FIQ FSM acceleration enabled for :<br>[    1.489017] Non-periodic Split Transactions<br>[    1.489017] Periodic Split Transactions<br>[    1.489017] High-Speed Isochronous Endpoints<br>[    1.512339] WARN::hcd_init_fiq:412: FIQ on core 0 at 0xc03dd6ac<br>[    1.519921] WARN::hcd_init_fiq:413: FIQ ASM at 0xc03dd988 length 36<br>[    1.527836] WARN::hcd_init_fiq:438: MPHI regs_base at 0xdc896000<br>[    1.535562] dwc_otg 20980000.usb: DWC OTG Controller<br>[    1.542176] dwc_otg 20980000.usb: new USB bus registered, assigned bus number 1<br>[    1.551213] dwc_otg 20980000.usb: irq 32, io mem 0x00000000<br>[    1.558460] Init: Port Power? op_state=1<br>[    1.563985] Init: Power Port (0)<br>[    1.569081] usb usb1: New USB device found, idVendor=1d6b, idProduct=0002<br>[    1.577540] usb usb1: New USB device strings: Mfr=3, Product=2, SerialNumber=1<br>[    1.586401] usb usb1: Product: DWC OTG Controller<br>[    1.592717] usb usb1: Manufacturer: Linux 4.1.18+ dwc_otg_hcd<br>[    1.600031] usb usb1: SerialNumber: 20980000.usb<br>[    1.607263] hub 1-0:1.0: USB hub found<br>[    1.612757] hub 1-0:1.0: 1 port detected<br>[    1.619430] usbcore: registered new interface driver usb-storage<br>[    1.627539] mousedev: PS/2 mouse device common for all mice<br>[    1.635776] bcm2835-cpufreq: min=700000 max=700000<br>[    1.642517] sdhci: Secure Digital Host Controller Interface driver<br>[    1.650338] sdhci: Copyright(c) Pierre Ossman<br>[    1.656701] sdhost: log_buf @ db813000 (5b813000)<br>[    1.742719] mmc0: sdhost-bcm2835 loaded - DMA enabled (&gt;1)<br>[    1.750373] sdhci-pltfm: SDHCI platform and OF driver helper<br>[    1.778602] ledtrig-cpu: registered to indicate activity on CPUs<br>[    1.786572] hidraw: raw HID events driver (C) Jiri Kosina<br>[    1.793960] usbcore: registered new interface driver usbhid<br>[    1.801132] usbhid: USB HID core driver<br>[    1.811110] Initializing XFRM netlink socket<br>[    1.817278] Indeed it is in host mode hprt0 = 00021501<br>[    1.884554] NET: Registered protocol family 17<br>[    1.890968] Key type dns_resolver registered<br>[    1.904841] registered taskstats version 1<br>[    1.910951] vc-sm: Videocore shared memory driver<br>[    1.917563] [vc_sm_connected_init]: start<br>[    1.924665] [vc_sm_connected_init]: end - returning 0<br>[    1.933842] Waiting for root device /dev/mmcblk0p2…<br>[    1.950344] mmc0: host does not support reading read-only switch, assuming write-enable<br>[    1.963583] mmc0: new high speed SDHC card at address b368<br>[    1.971566] mmcblk0: mmc0:b368 SDC   7.51 GiB<br>[    1.980155]  mmcblk0: p1 p2<br>[    2.052765] usb 1-1: new high-speed USB device number 2 using dwc_otg<br>[    2.061925] Indeed it is in host mode hprt0 = 00001101<br>[    2.130259] EXT4-fs (mmcblk0p2): mounted filesystem with ordered data mode. Opts: (null)<br>[    2.141890] VFS: Mounted root (ext4 filesystem) readonly on device 179:2.<br>[    2.159602] devtmpfs: mounted<br>[    2.165579] Freeing unused kernel memory: 352K (c0770000 - c07c8000)<br>[    2.283253] usb 1-1: New USB device found, idVendor=0424, idProduct=9512<br>[    2.292007] usb 1-1: New USB device strings: Mfr=0, Product=0, SerialNumber=0<br>[    2.302876] hub 1-1:1.0: USB hub found<br>[    2.309261] hub 1-1:1.0: 3 ports detected<br>[    2.564499] random: systemd urandom read with 61 bits of entropy available<br>[    2.579766] systemd[1]: systemd 215 running in system mode. (+PAM +AUDIT +SELINUX +IMA +SYSVINIT +LIBCRYPTSETUP +GCRYPT +ACL +XZ -SECCOMP -APPARMOR)<br>[    2.597128] usb 1-1.1: new high-speed USB device number 3 using dwc_otg // USB information<br>[    2.606478] systemd[1]: Detected architecture ‘arm’.<br>[    2.713310] usb 1-1.1: New USB device found, idVendor=0424, idProduct=ec00<br>[    2.722251] usb 1-1.1: New USB device strings: Mfr=0, Product=0, SerialNumber=0<br>[    2.748879] NET: Registered protocol family 10<br>[    2.758094] systemd[1]: Inserted module ‘ipv6’<br>[    2.765114] smsc95xx v1.0.4<br>[    2.777284] systemd[1]: Set hostname to <raspberrypi>.<br>[    2.831806] smsc95xx 1-1.1:1.0 eth0: register ‘smsc95xx’ at usb-20980000.usb-1.1, smsc95xx USB 2.0 Ethernet, b8:27:eb:33:a7:96<br>[    2.921707] uart-pl011 20201000.uart: no DMA platform data<br>[    3.510755] systemd[1]: Cannot add dependency job for unit display-manager.service, ignoring: Unit display-manager.service failed to load: No such file or directory.<br>[    3.537318] systemd[1]: Starting Forward Password Requests to Wall Directory Watch.<br>[    3.549967] systemd[1]: Started Forward Password Requests to Wall Directory Watch.<br>[    3.561823] systemd[1]: Expecting device dev-ttyAMA0.device…<br>[    3.572924] systemd[1]: Starting Remote File Systems (Pre).<br>[    3.583543] systemd[1]: Reached target Remote File Systems (Pre).<br>[    3.592030] systemd[1]: Starting Encrypted Volumes.<br>[    3.601895] systemd[1]: Reached target Encrypted Volumes.<br>[    3.609815] systemd[1]: Starting Arbitrary Executable File Formats File System Automount Point.<br>[    3.626548] systemd[1]: Set up automount Arbitrary Executable File Formats File System Automount Point.<br>[    3.640487] systemd[1]: Starting Swap.<br>[    3.649274] systemd[1]: Reached target Swap.<br>[    3.655869] systemd[1]: Expecting device dev-mmcblk0p1.device…<br>[    3.666639] systemd[1]: Starting Root Slice.<br>[    3.675708] systemd[1]: Created slice Root Slice.<br>[    3.682457] systemd[1]: Starting User and Session Slice.<br>[    3.692893] systemd[1]: Created slice User and Session Slice.<br>[    3.700698] systemd[1]: Starting /dev/initctl Compatibility Named Pipe.<br>[    3.712171] systemd[1]: Listening on /dev/initctl Compatibility Named Pipe.<br>[    3.721334] systemd[1]: Starting Delayed Shutdown Socket.<br>[    3.731613] systemd[1]: Listening on Delayed Shutdown Socket.<br>[    3.739521] systemd[1]: Starting Journal Socket (/dev/log).<br>[    3.749939] systemd[1]: Listening on Journal Socket (/dev/log).<br>[    3.758004] systemd[1]: Starting udev Control Socket.<br>[    3.767775] systemd[1]: Listening on udev Control Socket.<br>[    3.775334] systemd[1]: Starting udev Kernel Socket.<br>[    3.784937] systemd[1]: Listening on udev Kernel Socket.<br>[    3.792291] systemd[1]: Starting Journal Socket.<br>[    3.801797] systemd[1]: Listening on Journal Socket.<br>[    3.809032] systemd[1]: Starting System Slice.<br>[    3.818276] systemd[1]: Created slice System Slice.<br>[    3.825377] systemd[1]: Starting File System Check on Root Device…<br>[    3.840897] systemd[1]: Starting system-systemd\x2dfsck.slice.<br>[    3.861987] systemd[1]: Created slice system-systemd\x2dfsck.slice.<br>[    3.873883] systemd[1]: Starting system-getty.slice.<br>[    3.894040] systemd[1]: Created slice system-getty.slice.<br>[    3.903948] systemd[1]: Starting system-serial\x2dgetty.slice.<br>[    3.916204] systemd[1]: Created slice system-serial\x2dgetty.slice.<br>[    3.925608] systemd[1]: Starting Increase datagram queue length…<br>[    3.951212] systemd[1]: Starting Restore / save the current clock…<br>[    3.988340] systemd[1]: Starting udev Coldplug all Devices…<br>[    4.061012] systemd[1]: Started Set Up Additional Binary Formats.<br>[    4.116562] systemd[1]: Starting Load Kernel Modules…<br>[    4.188874] systemd[1]: Mounting POSIX Message Queue File System…<br>[    4.295465] systemd[1]: Mounting Debug File System…<br>[    4.320276] systemd[1]: Mounted Huge Pages File System.<br>[    4.343804] systemd[1]: Starting Create list of required static device nodes for the current kernel…<br>[    4.364861] systemd[1]: Starting Slices.<br>[    4.381353] systemd[1]: Reached target Slices.<br>[    4.397220] systemd[1]: Started Increase datagram queue length.<br>[    4.704288] systemd[1]: Started File System Check on Root Device.<br>[    4.733046] systemd[1]: Started Restore / save the current clock.<br>[    4.766911] systemd[1]: Started Load Kernel Modules.<br>[    4.793010] systemd[1]: Mounted POSIX Message Queue File System.<br>[    4.815336] systemd[1]: Mounted Debug File System.<br>[    4.842933] systemd[1]: Started Create list of required static device nodes for the current kernel.<br>[    4.881438] systemd[1]: Time has been changed<br>[    4.939493] systemd[1]: Started udev Coldplug all Devices.<br>[    5.196823] systemd[1]: Starting Create Static Device Nodes in /dev…<br>[    5.214792] systemd[1]: Mounting Configuration File System…<br>[    5.244766] systemd[1]: Starting Apply Kernel Variables…<br>[    5.309277] systemd[1]: Mounted FUSE Control File System.<br>[    5.339617] systemd[1]: Starting Syslog Socket.<br>[    5.380159] systemd[1]: Listening on Syslog Socket.</raspberrypi></p>
<p>Raspbian GNU/Linux 8 raspberrypi ttyAMA0</p>
<h2 id="Download"><a href="#Download" class="headerlink" title="Download"></a>Download</h2><p><a href="/download/Win32DiskImager-0.9.5-install.exe">Win32DiskImager-0.9.5-install.exe</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/03/09/init-raspberry/" data-id="cin404794000b4kcj0q3lx6dn" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/RaspberryPi/">RaspberryPi</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-access-data-jpa" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/03/08/access-data-jpa/" class="article-date">
  <time datetime="2016-03-08T20:20:32.000Z" itemprop="datePublished">2016-03-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Web/">Web</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/08/access-data-jpa/">Access data with JPA in Spring</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Now that you could start up a Spring Web Application, where data persistence will play significant role.<br>Thus, I will present how to integerate <code>JPA</code>(java persitence api) with <code>Spring.</code></p>
<h2 id="Gradle-build-file"><a href="#Gradle-build-file" class="headerlink" title="Gradle build file"></a>Gradle build file</h2><p>First of all, you must finish your <code>Gradle</code> build file which is <code>build.gradle</code>.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">buildscript &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        mavenCentral()</span><br><span class="line">    &#125;</span><br><span class="line">    dependencies &#123;</span><br><span class="line">        classpath(&quot;org.springframework.boot:spring-boot-gradle-plugin:1.3.3.RELEASE&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">apply plugin: &apos;java&apos;</span><br><span class="line">apply plugin: &apos;eclipse&apos;</span><br><span class="line">apply plugin: &apos;idea&apos;</span><br><span class="line">apply plugin: &apos;spring-boot&apos;</span><br><span class="line"></span><br><span class="line">jar &#123;</span><br><span class="line">    baseName = &apos;gs-rest-service&apos;</span><br><span class="line">    version = &apos;0.1.0&apos;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">repositories &#123;</span><br><span class="line">    mavenCentral()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sourceCompatibility = 1.8</span><br><span class="line">targetCompatibility = 1.8</span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">    compile(&quot;org.springframework.boot:spring-boot-starter-web&quot;)</span><br><span class="line">    compile(&quot;org.springframework.boot:spring-boot-starter-data-rest&quot;)</span><br><span class="line">    compile(&quot;org.springframework.boot:spring-boot-starter-data-jpa&quot;)</span><br><span class="line">    compile(&quot;mysql:mysql-connector-java:5.1.6&quot;)</span><br><span class="line">    compile(&quot;com.h2database:h2&quot;)</span><br><span class="line">    testCompile(&quot;junit:junit&quot;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">task wrapper(type: Wrapper) &#123;</span><br><span class="line">    gradleVersion = &apos;2.5&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>In order to access database, which is <code>MySQL</code> that I use, we’d better append <code>mysql connector</code> to this project.<br>And <code>spring-boot-starter-data-jpa</code> is spring jpa package. The <code>spring-boot-starter-data-rest</code><br>would be used later, which would enhance the RESTful data accessing.</p>
<h2 id="Configure-JPA"><a href="#Configure-JPA" class="headerlink" title="Configure JPA"></a>Configure JPA</h2><p>It’s neccessary to connect JPA with database. Of course, JPA would work out even without database. The requirement<br>of data persistence force us to support with a database. As you know, The <code>MySQL</code> database is my choice. And this setting<br>is stored in a file which is <code>application.properties</code>. Now let crate a new file.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">└── src</span><br><span class="line">    └── main</span><br><span class="line">        └── resources</span><br><span class="line">            └── application.properties</span><br></pre></td></tr></table></figure></p>
<p>And input script below.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#DB properties:</span><br><span class="line">spring.datasource.url=jdbc:mysql://localhost:3306/test</span><br><span class="line">spring.datasource.username=root</span><br><span class="line">spring.datasource.password=password</span><br><span class="line">spring.datasource.driverClassName=com.mysql.jdbc.Driver</span><br><span class="line"></span><br><span class="line">#JPA Configuration:</span><br><span class="line">spring.jpa.show-sql=true</span><br><span class="line">spring.jpa.hibernate.ddl-auto=update</span><br><span class="line"></span><br><span class="line">#view Configuration:</span><br><span class="line">spring.view.prefix=/WEB-INF/views/</span><br><span class="line"></span><br><span class="line">#Server Configuration:</span><br><span class="line">server.port = 90</span><br></pre></td></tr></table></figure></p>
<p>Make sure you could build this project.<br><img src="/images/access-data-jpa/jpa-conf.png" style="width: 700px;"></p>
<h2 id="Define-a-simple-entity"><a href="#Define-a-simple-entity" class="headerlink" title="Define a simple entity"></a>Define a simple entity</h2><p>In this example, you store Customer objects, annotated as JPA entity.<br><code>src/main/java/hello/Customer.java</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">package hello;</span><br><span class="line"></span><br><span class="line">import javax.persistence.Entity;</span><br><span class="line">import javax.persistence.GeneratedValue;</span><br><span class="line">import javax.persistence.GenerationType;</span><br><span class="line">import javax.persistence.Id;</span><br><span class="line"></span><br><span class="line">@Entity</span><br><span class="line">public class Customer &#123;</span><br><span class="line"></span><br><span class="line">    @Id</span><br><span class="line">    @GeneratedValue(strategy=GenerationType.AUTO)</span><br><span class="line">    private long id;</span><br><span class="line">    private String firstName;</span><br><span class="line">    private String lastName;</span><br><span class="line"></span><br><span class="line">    protected Customer() &#123;&#125;</span><br><span class="line"></span><br><span class="line">    public Customer(String firstName, String lastName) &#123;</span><br><span class="line">        this.firstName = firstName;</span><br><span class="line">        this.lastName = lastName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return String.format(</span><br><span class="line">                &quot;Customer[id=%d, firstName=&apos;%s&apos;, lastName=&apos;%s&apos;]&quot;,</span><br><span class="line">                id, firstName, lastName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="Create-simple-queries"><a href="#Create-simple-queries" class="headerlink" title="Create simple queries"></a>Create simple queries</h2><p>Spring Data JPA focuses on using JPA to store data in a relational database. Its most<br>compelling feature is the ability to create repository implementations automatically,<br>at runtime, from a repository interface.<br><code>src/main/java/hello/CustomerRepository.java</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">package hello;</span><br><span class="line"></span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">import org.springframework.data.repository.CrudRepository;</span><br><span class="line"></span><br><span class="line">public interface CustomerRepository extends CrudRepository&lt;Customer, Long&gt; &#123;</span><br><span class="line"></span><br><span class="line">    List&lt;Customer&gt; findByLastName(String lastName);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="Enhance-the-Application-Class"><a href="#Enhance-the-Application-Class" class="headerlink" title="Enhance the Application Class"></a>Enhance the Application Class</h2><p>Now that we have created a <code>App.java</code>, we should append some code.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">package hello;</span><br><span class="line"></span><br><span class="line">import org.slf4j.Logger;</span><br><span class="line">import org.slf4j.LoggerFactory;</span><br><span class="line">import org.springframework.boot.CommandLineRunner;</span><br><span class="line">import org.springframework.boot.SpringApplication;</span><br><span class="line">import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@SpringBootApplication</span><br><span class="line">public class App &#123;</span><br><span class="line">    private static final Logger log = LoggerFactory.getLogger(App.class);</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        SpringApplication.run(App.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public CommandLineRunner demo(CustomerRepository repository) &#123;</span><br><span class="line">        return (args) -&gt; &#123;</span><br><span class="line">            // save a couple of customers</span><br><span class="line">            repository.save(new Customer(&quot;Jack&quot;, &quot;Bauer&quot;));</span><br><span class="line">            repository.save(new Customer(&quot;Chloe&quot;, &quot;O&apos;Brian&quot;));</span><br><span class="line">            repository.save(new Customer(&quot;Kim&quot;, &quot;Bauer&quot;));</span><br><span class="line">            repository.save(new Customer(&quot;David&quot;, &quot;Palmer&quot;));</span><br><span class="line">            repository.save(new Customer(&quot;Michelle&quot;, &quot;Dessler&quot;));</span><br><span class="line"></span><br><span class="line">            // fetch all customers</span><br><span class="line">            log.info(&quot;Customers found with findAll():&quot;);</span><br><span class="line">            log.info(&quot;-------------------------------&quot;);</span><br><span class="line">            for (Customer customer : repository.findAll()) &#123;</span><br><span class="line">                log.info(customer.toString());</span><br><span class="line">            &#125;</span><br><span class="line">            log.info(&quot;&quot;);</span><br><span class="line"></span><br><span class="line">            // fetch an individual customer by ID</span><br><span class="line">            Customer customer = repository.findOne(1L);</span><br><span class="line">            log.info(&quot;Customer found with findOne(1L):&quot;);</span><br><span class="line">            log.info(&quot;--------------------------------&quot;);</span><br><span class="line">            log.info(customer.toString());</span><br><span class="line">            log.info(&quot;&quot;);</span><br><span class="line"></span><br><span class="line">            // fetch customers by last name</span><br><span class="line">            log.info(&quot;Customer found with findByLastName(&apos;Bauer&apos;):&quot;);</span><br><span class="line">            log.info(&quot;--------------------------------------------&quot;);</span><br><span class="line">            for (Customer bauer : repository.findByLastName(&quot;Bauer&quot;)) &#123;</span><br><span class="line">                log.info(bauer.toString());</span><br><span class="line">            &#125;</span><br><span class="line">            log.info(&quot;&quot;);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Build and run the project!</p>
<h2 id="Database-Result"><a href="#Database-Result" class="headerlink" title="Database Result"></a>Database Result</h2><p>You should see something like this:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">== Customers found with findAll():</span><br><span class="line">Customer[id=1, firstName=&apos;Jack&apos;, lastName=&apos;Bauer&apos;]</span><br><span class="line">Customer[id=2, firstName=&apos;Chloe&apos;, lastName=&apos;O&apos;Brian&apos;]</span><br><span class="line">Customer[id=3, firstName=&apos;Kim&apos;, lastName=&apos;Bauer&apos;]</span><br><span class="line">Customer[id=4, firstName=&apos;David&apos;, lastName=&apos;Palmer&apos;]</span><br><span class="line">Customer[id=5, firstName=&apos;Michelle&apos;, lastName=&apos;Dessler&apos;]</span><br><span class="line"></span><br><span class="line">== Customer found with findOne(1L):</span><br><span class="line">Customer[id=1, firstName=&apos;Jack&apos;, lastName=&apos;Bauer&apos;]</span><br><span class="line"></span><br><span class="line">== Customer found with findByLastName(&apos;Bauer&apos;):</span><br><span class="line">Customer[id=1, firstName=&apos;Jack&apos;, lastName=&apos;Bauer&apos;]</span><br><span class="line">Customer[id=3, firstName=&apos;Kim&apos;, lastName=&apos;Bauer&apos;]</span><br></pre></td></tr></table></figure></p>
<p><img src="/images/access-data-jpa/result.png" style="width: 700px;"><br>As you could see, a new table whose name is <code>customer</code> has been created.<br>And data has been stored successfully.</p>
<h2 id="Refernce"><a href="#Refernce" class="headerlink" title="Refernce"></a>Refernce</h2><p><a href="https://spring.io/guides/gs/accessing-data-jpa/" target="_blank" rel="external">https://spring.io/guides/gs/accessing-data-jpa/</a></p>
<h2 id="Download"><a href="#Download" class="headerlink" title="Download"></a>Download</h2><p><a href="/download/spring-demo-jpa.rar">spring-demo-jpa.rar</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/03/08/access-data-jpa/" data-id="cin4047ay000i4kcjyflbajs4" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JPA/">JPA</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Spring/">Spring</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">__('next') &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Embedded-System/">Embedded System</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web/">Web</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ARM/">ARM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Gradle/">Gradle</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JPA/">JPA</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RaspberryPi/">RaspberryPi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/STM32/">STM32</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spring/">Spring</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WRTNode/">WRTNode</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/ARM/" style="font-size: 10px;">ARM</a> <a href="/tags/Gradle/" style="font-size: 10px;">Gradle</a> <a href="/tags/JPA/" style="font-size: 10px;">JPA</a> <a href="/tags/Java/" style="font-size: 20px;">Java</a> <a href="/tags/RaspberryPi/" style="font-size: 10px;">RaspberryPi</a> <a href="/tags/STM32/" style="font-size: 20px;">STM32</a> <a href="/tags/Spring/" style="font-size: 20px;">Spring</a> <a href="/tags/WRTNode/" style="font-size: 10px;">WRTNode</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/04/16/stm-interrupt-driven/">Interrupt Driven STM32</a>
          </li>
        
          <li>
            <a href="/2016/04/08/init-stm32/">Getting Started with STM32 in Windows</a>
          </li>
        
          <li>
            <a href="/2016/03/31/arm-inst/">Stuff in ARM Instruction</a>
          </li>
        
          <li>
            <a href="/2016/03/09/init-raspberry/">Getting started with RaspberryPi</a>
          </li>
        
          <li>
            <a href="/2016/03/08/access-data-jpa/">Access data with JPA in Spring</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 Sea Hai<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>